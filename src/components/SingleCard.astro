---
import SpotifyEmbed from './SpotifyEmbed.astro';
import PlatformLinks from './PlatformLinks.astro';
import type { Release } from '../types/releases';

interface Props {
  release: Release;
}

const { release } = Astro.props;
const hasArtwork = release.artworkUrl && release.artworkUrl.length > 0;
// Use the release's album ID with type=album â€” individual track IDs not yet available.
const embedId = release.spotifyId;
---
<article class="bg-surface rounded-2xl overflow-hidden border border-white/5 flex flex-col hover:-translate-y-0.5 transition-transform duration-200">
  <!-- Artwork -->
  {hasArtwork ? (
    <a href={release.spotifyUrl} target="_blank" rel="noopener noreferrer" class="block">
      <img
        src={release.artworkUrl}
        alt={`${release.title} artwork`}
        width="400"
        height="400"
        class="w-full aspect-square object-cover"
        loading="lazy"
      />
    </a>
  ) : (
    <a href={release.spotifyUrl} target="_blank" rel="noopener noreferrer"
       class="block w-full aspect-square bg-elevated flex items-center justify-center">
      <span class="font-display text-5xl font-bold text-text-muted">
        {release.title.charAt(0)}
      </span>
    </a>
  )}

  <!-- Info -->
  <div class="px-4 pt-4 pb-2 flex-1">
    <h3 class="font-display text-base font-semibold text-text-primary leading-snug line-clamp-2">
      {release.title}
    </h3>
    <p class="text-xs text-text-muted mt-0.5">{release.year}</p>
  </div>

  <!-- Spotify embed (compact) -->
  <div class="px-4">
    <SpotifyEmbed spotifyId={embedId} type="album" height={152} />
  </div>

  <!-- Platform links -->
  <div class="px-4 py-3">
    <PlatformLinks
      spotifyUrl={release.spotifyUrl}
      appleMusicUrl={release.appleMusicUrl}
      amazonMusicUrl={release.amazonMusicUrl}
      youtubeUrl={release.youtubeUrl}
      size={16}
    />
  </div>
</article>
